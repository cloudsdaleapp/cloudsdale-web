do ($ = jQuery) ->
  
  window.NotificationCentre = class NotificationCentre
  
    constructor: (args) ->
      @cli = new Faye.Client("<%=Cloudsdale.faye_path(:client)%>", { timeout: 1000 })
      subscription = @cli.subscribe('/')
      
      subscription.callback =>
        if @cli.getState() == 'CONNECTED'
          $.event.trigger "connected:nfc"

      subscription.errback =>
        if @cli.getState() == 'CONNECTED'
          $.event.trigger "connected:nfc"
    
    state: ->
      @cli.getState()
    
    # Use this to start listening to a specific channel
    on: (event,f) ->
      
      channel = "/#{event.replace(/\:/ig,"/")}" # The event name translated to Faye channel
                  
      if @cli._channels._channels[channel] == undefined
        subscription = @cli.subscribe channel, (payload) ->
          $.event.trigger "#{event}", payload
      
      $(document).bind "#{event}", (event,payload) ->
        f(payload)
        
      this
    
    # Use this to simulate an incomming payload
    t: (event,data) -> $.event.trigger "#{event}", data