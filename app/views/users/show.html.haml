.page-header
  .row
    .span3
      - if @user.avatar.url
        = image_tag @user.avatar, :title => @user.character.name, :class => 'avatar'
      - else
        = image_tag "other/unknown_pony.jpg", :title => @user.character.name, :class => 'avatar'
    .span2
      %h5.gender= @user.character.gender.capitalize if @user.character.gender
      %h5.kind= @user.character.kind.capitalize if @user.character.kind
      %h5.subscribers= "#{@user.subscriber_ids.count} subscribers"
    .span11
      %h1
        = @user.character.name
      %h4
        - if @user.is_online?
          %span{ :class => "online"}= "Online"
          = "Last activity #{time_ago_in_words(@user.last_activity)} ago"
        - else
          %span{ :class => "offline"}= "Offline"
          = "Last activity #{time_ago_in_words(@user.last_activity)} ago"
      %ul.tabs
        %li{ :class => "#{ params[:tab].nil? ? 'active' : '' }" }
          = link_to "Profile", user_path(@user)
        %li{ :class => "#{ params[:tab] == 'articles' ? 'active' : '' }" }
          = link_to "Articles", user_path(@user, tab: 'articles')
    
.row
  .span4.left
    - unless @user == current_user
      - if @user.subscribers.include?(current_user)
        = link_to "Unsubscribe", user_subscriber_path(@user,current_user), method: :delete, :class => 'btn error', 'data-skip-pjax' => true
      - else
        = link_to "Subscribe", user_subscribers_path(@user), method: :post, :class => 'btn success', 'data-skip-pjax' => true
    - else
      = link_to "Settings", edit_user_path(@user), class: 'btn'
    
    
  .span12.right
        
    - if params[:tab].nil?
      - @user.activities.order(:timestamp => :desc).each do |activity|
        %p{ :style => 'padding-left: 20px;'}
          = link_to activity.text, activity.url
          %span.time= "#{time_ago_in_words(activity.timestamp).capitalize} ago"
    - elsif params[:tab] == 'articles'
      - if @articles
        = paginate @articles, :left => 2, :right => 2, :window => 6, :param_name => :articles_page
        %ul.unstyled.articles
          - @articles.each do |article|
            %li
              .row
                .span12
                  %h3
                    = link_to article.title, article_path(article)
                    %span.view_count= article.views
                    %span.comment_count= article.comments.count
                  
              .row
                .span12
                  .actions
                    - if can? :manage, article
                      = link_to "Edit", edit_article_path(article), :class => 'btn small'
                      - unless article.published
                        = link_to "Publish", publish_article_path(article), :class => 'btn success small'
                      = link_to "Delete", article_path(article), :method => :delete, :class => 'btn error small'
                    - else
                      = link_to "Read", article_path(article), :class => 'btn small'
                    %span.time
                      = article.updated_at.strftime('%Y/%m/%d - %R')
                  
      - else
        %h6 No articles...
          
          
          
          